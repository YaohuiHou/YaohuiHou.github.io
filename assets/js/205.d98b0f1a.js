(window.webpackJsonp=window.webpackJsonp||[]).push([[205],{434:function(t,a,n){"use strict";n.r(a);var s=n(1),o=Object(s.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("div",{staticClass:"content"},[n("h2",{attrs:{id:"预编译"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#预编译","aria-hidden":"true"}},[t._v("#")]),t._v(" 预编译")]),n("blockquote",[n("p",[t._v("我们在上一篇文章《作用域》中简单讲过“变量提升”，今天来讲一下预编译，这对我们深入理解变量提升会有帮助。")])]),n("h2",{attrs:{id:"javascript-运行三部曲"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascript-运行三部曲","aria-hidden":"true"}},[t._v("#")]),t._v(" JavaScript 运行三部曲")]),n("ul",[n("li",[n("p",[t._v("语法分析")])]),n("li",[n("p",[t._v("预编译")])]),n("li",[n("p",[t._v("解释执行")])])]),n("h2",{attrs:{id:"预编译前奏"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#预编译前奏","aria-hidden":"true"}},[t._v("#")]),t._v(" 预编译前奏")]),n("blockquote",[n("p",[t._v("在讲预编译前，我们先来普及下面两个规律。")])]),n("h3",{attrs:{id:"两个规律"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#两个规律","aria-hidden":"true"}},[t._v("#")]),t._v(" 两个规律")]),n("p",[n("strong",[t._v("规律1：任何变量，如果未经声明就赋值，此变量是属于 window 的属性")]),t._v("，而且不会做变量提升。（注意，无论在哪个作用域内赋值）")]),n("p",[t._v("比如说，如果我们直接在代码里写 "),n("code",[t._v("console.log(a)")]),t._v("，这肯定会报错的，提示找不到 "),n("code",[t._v("a")]),t._v("。但如果我直接写 "),n("code",[t._v("a = 100")]),t._v("，这就不会报错，此时，这个 "),n("code",[t._v("a")]),t._v(" 就是 "),n("code",[t._v("window.a")]),t._v("。")]),n("p",[n("strong",[t._v("规律2：一切声明的全局变量，全是window的属性")]),t._v("。（注意，我说的是在全局作用域内声明的全局变量，不是说局部变量）")]),n("p",[t._v("比如说，当我定义 "),n("code",[t._v("var a = 200")]),t._v(" 时，这此时这个 "),n("code",[t._v("a")]),t._v(" 就是 "),n("code",[t._v("window.a")]),t._v("。")]),n("p",[t._v("由此，我们可以看出："),n("strong",[t._v("window 代表了全局作用域")]),t._v("（是说「代表」，没说「等于」）。")]),n("h3",{attrs:{id:"举例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#举例","aria-hidden":"true"}},[t._v("#")]),t._v(" 举例")]),n("p",[t._v("掌握了上面两句话之后，我们再来看看下面的例子。")]),n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("foo")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" b "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("100")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 连续赋值")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token function"}},[t._v("foo")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 在全局范围内访问 b")]),t._v("\nconsole"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 在全局范围内访问 b，但是前面没有加 window 这个关键字")]),t._v("\n\nconsole"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 在全局范围内访问 a")]),t._v("\nconsole"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 在全局范围内访问 a，但是前面没有加 window 这个关键字")]),t._v("\n\n")])]),n("p",[t._v("上方代码的打印结果：")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("100\n\n100\n\nundefined\n\n（会报错，提示 Uncaught ReferenceError: a is not defined）\n\n")])]),n("p",[n("strong",[t._v("解释")]),t._v("：")]),n("p",[t._v("当执行了"),n("code",[t._v("foo()")]),t._v("函数之后， "),n("code",[t._v("var a = b = 100")]),t._v(" 这行"),n("strong",[t._v("连续赋值")]),t._v("的代码等价于 "),n("code",[t._v("var a = (b = 100)")]),t._v("，其执行顺序是：")]),n("p",[t._v("（1）先把 100 赋值给 b；")]),n("p",[t._v("（2）再声明变量 a；")]),n("p",[t._v("（3）再把 b 的值赋值给 a。")]),n("p",[t._v("我们可以看到，b 是未经声明的变量就被赋值了，此时，根据规律1，这个 b 是属于 "),n("code",[t._v("window.b")]),t._v("；而 a 的作用域仅限于 foo() 函数内部，不属于 window。所以也就有了这样的打印结果。")]),n("h2",{attrs:{id:"预编译-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#预编译-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 预编译")]),n("h3",{attrs:{id:"函数预编译的步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#函数预编译的步骤","aria-hidden":"true"}},[t._v("#")]),t._v(" 函数预编译的步骤")]),n("blockquote",[n("p",[t._v("函数预编译，发生在函数执行的前一刻。")])]),n("p",[t._v("（1）创建AO对象。AO即 Activation Object 活跃对象，其实就是「执行期上下文」。")]),n("p",[t._v("（2）找形参和变量声明，将形参名和变量作为 AO 的属性名，值为undefined。")]),n("p",[t._v("（3）将实参值和形参统一，实参的值赋给形参。")]),n("p",[t._v("（4）查找函数声明，函数名作为 AO 对象的属性名，值为整个函数体。")]),n("p",[t._v("这个地方比较难理解。但只有了解了函数的预编译，才能理解明白函数的执行顺序。")]),n("p",[t._v("代码举例：")]),n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("fn")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("666")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("a")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),n("span",{attrs:{class:"token function-variable function"}},[t._v("b")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("c")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token function"}},[t._v("fn")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),n("p",[t._v("打印结果：")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("ƒ a() {}\n666\n666\nƒ () {}\n")])]),n("h2",{attrs:{id:"参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考链接","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考链接")]),n("ul",[n("li",[n("p",[t._v("JavaScript预编译原理分析："),n("a",{attrs:{href:"https://blog.csdn.net/q1056843325/article/details/52951114",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/q1056843325/article/details/52951114")])])]),n("li",[n("p",[n("a",{attrs:{href:"https://segmentfault.com/a/1190000018001871",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://segmentfault.com/a/1190000018001871")])])]),n("li",[n("p",[t._v("预编译及变量提升："),n("a",{attrs:{href:"https://juejin.im/post/5aa6693df265da23884cb571",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://juejin.im/post/5aa6693df265da23884cb571")])])]),n("li",[n("p",[n("a",{attrs:{href:"https://juejin.im/post/5adaf8215188256712781830",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://juejin.im/post/5adaf8215188256712781830")])])]),n("li",[n("p",[n("a",{attrs:{href:"https://www.qqzmly.com/archives/1521",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.qqzmly.com/archives/1521")])])]),n("li",[n("p",[t._v("宏任务&微任务相关："),n("a",{attrs:{href:"https://segmentfault.com/a/1190000018134157",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://segmentfault.com/a/1190000018134157")])])])])])}],!1,null,null,null);a.default=o.exports}}]);