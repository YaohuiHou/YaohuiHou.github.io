(window.webpackJsonp=window.webpackJsonp||[]).push([[276],{505:function(t,n,s){"use strict";s.r(n);var a=s(1),e=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"content"},[s("h2",{attrs:{id:"客户端例子：不受信任的证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端例子：不受信任的证书","aria-hidden":"true"}},[t._v("#")]),t._v(" 客户端例子：不受信任的证书")]),s("p",[t._v("我们知道，有些网站的HTTPS证书会被浏览器标识为不受信任，有可能是以下情况导致的：")]),s("ul",[s("li",[t._v("颁发证书的机构不在操作系统的受信列表里")]),s("li",[t._v("办法证书的机构在操作系统的受信列表里，但证书的安全级别不够")])]),s("p",[t._v("比如我们访问"),s("a",{attrs:{href:"https://kyfw.12306.cn/otn/regist/init",target:"_blank",rel:"noopener noreferrer"}},[t._v("12306")]),t._v("，chrome就会提示你“您的连接不是私密连接，攻击者可能会试图从kyfw.12306.cn窃取您的信息”。")]),s("p",[t._v("那么，当我们用node向12306发起请求时，又会是什么状况呢？下面就来试下")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" https "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("require")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'https'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nhttps"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'https://www.baidu.com'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("on")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'data'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        process"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdout"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("write")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("on")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'error'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("error")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("p",[t._v("运行上面代码，输出如下。可以看到出现报错，提示信息是“self signed certificate in certificate chain”。大意就是说证书是网站自己签发的，不安全。")]),s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Error: self signed certificate "),s("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" certificate chain\n    at Error "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("native"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at TLSSocket."),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("anonymous"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_tls_wrap.js:1055:38"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at emitNone "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events.js:86:13"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at TLSSocket.emit "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events.js:185:7"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at TLSSocket._finishInit "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_tls_wrap.js:580:8"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at TLSWrap.ssl.onhandshakedone "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_tls_wrap.js:412:38"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" code: "),s("span",{attrs:{class:"token string"}},[t._v("'SELF_SIGNED_CERT_IN_CHAIN'")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("p",[t._v("出现上述错误怎么处理呢？我们知道，如果是在浏览器里访问，有两种处理方式：")]),s("ul",[s("li",[t._v("忽略浏览器的安全提示，继续访问（浏览器可能会直接禁止你访问）")]),s("li",[t._v("将网站的根证书导入到操作系统的受信任根证书列表里")])]),s("h2",{attrs:{id:"入门示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#入门示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 入门示例")]),s("p",[t._v("TODO")]),s("h2",{attrs:{id:"基础讲解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础讲解","aria-hidden":"true"}},[t._v("#")]),t._v(" 基础讲解")]),s("p",[t._v("。。。")]),s("h2",{attrs:{id:"本地证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地证书","aria-hidden":"true"}},[t._v("#")]),t._v(" 本地证书")]),s("p",[t._v("。。。")]),s("h2",{attrs:{id:"服务器：自签名证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器：自签名证书","aria-hidden":"true"}},[t._v("#")]),t._v(" 服务器：自签名证书")]),s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("➜  server git:"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("master"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ✗ "),s("span",{attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" cert\n➜  server git:"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("master"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ✗ "),s("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" cert \n➜  cert git:"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("master"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ✗ openssl genrsa -out chyingp-key.pem 2048\nGenerating RSA private key, 2048 bit long modulus\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".+++\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v("+++\ne is 65537 "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x10001"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n➜  cert git:"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("master"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ✗ openssl req -new -sha256 -key chyingp-key.pem -out chyingp-csr.pem\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter "),s("span",{attrs:{class:"token string"}},[t._v("'.'")]),t._v(", the field will be left blank.\n-----\nCountry Name "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2 letter code"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AU"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":CN\nState or Province Name "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("full name"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Some-State"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":Guangdong\nLocality Name "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, city"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":Shenzhen\nOrganization Name "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, company"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Internet Widgits Pty Ltd"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":YH\nOrganizational Unit Name "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eg, section"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":web\nCommon Name "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e.g. server FQDN or YOUR name"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":www.chyingp.com\nEmail Address "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":416394284@qq.com\n\nPlease enter the following "),s("span",{attrs:{class:"token string"}},[t._v("'extra'")]),t._v(" attributes\nto be sent with your certificate request\nA challenge password "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":123456\nAn optional company name "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":YH\n➜  cert git:"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("master"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ✗ openssl x509 -req -in chyingp-csr.pem -signkey chyingp-key.pem -out chyingp-cert.pem\n")])]),s("h2",{attrs:{id:"私有ca签名的证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#私有ca签名的证书","aria-hidden":"true"}},[t._v("#")]),t._v(" 私有CA签名的证书")]),s("p",[t._v("首先，创建自签名的CA证书")]),s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("# 创建ca的私钥")]),t._v("\nopenssl genrsa -out my-ca.key.pem 2048\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("# 创建ca的证书")]),t._v("\nopenssl req \\\n  -x509 \\\n  -new \\\n  -nodes \\\n  -key my-ca.key.pem \\\n  -days 1024 \\\n  -out my-ca.crt.pem \\\n  -subj "),s("span",{attrs:{class:"token string"}},[t._v('"/C=CN/ST=Guandong/L=Shenzhen/O=YH Inc/CN=chyingp.com"')]),t._v("\n")])]),s("p",[t._v("然后，创建用CA的私钥进行签名的网站证书")]),s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("# 创建私钥")]),t._v("\nopenssl genrsa \\\n  -out my-server.key.pem \\\n  2048  \n\n"),s("span",{attrs:{class:"token comment"}},[t._v("# 创建证书签名请求")]),t._v("\nopenssl req -new \\\n  -key my-server.key.pem \\\n  -out my-server.csr.pem \\\n  -subj "),s("span",{attrs:{class:"token string"}},[t._v('"/C=CN/ST=Guandong/L=Shenzhen/O=YH Inc/CN=www.chyingp.com"')]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("# 创建网站证书")]),t._v("\nopenssl x509 \\\n  -req -in my-server.csr.pem \\\n  -CA my-ca.crt.pem \\\n  -CAkey my-ca.key.pem \\\n  -CAcreateserial \\\n  -out my-server.crt.pem \\\n  -days 500  \n")])])])}],!1,null,null,null);n.default=e.exports}}]);