(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{514:function(t,a,s){"use strict";s.r(a);var n=s(1),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介","aria-hidden":"true"}},[t._v("#")]),t._v(" 简介")]),s("p",[t._v("Diffie-Hellman（简称DH）是密钥交换算法之一，它的作用是保证通信双方在非安全的信道中安全地交换密钥。目前DH最重要的应用场景之一，就是在HTTPS的握手阶段，客户端、服务端利用DH算法交换对称密钥。")]),s("p",[t._v("下面会先简单介绍DH的数理基础，然后举例说明如何在nodejs中使用DH相关的API。")]),s("h2",{attrs:{id:"数论基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数论基础","aria-hidden":"true"}},[t._v("#")]),t._v(" 数论基础")]),s("p",[t._v("要理解DH算法，需要掌握一定的数论基础。感兴趣的可以进一步研究推导过程，或者直接记住下面结论，然后进入下一节。")]),s("ol",[s("li",[t._v("假设 Y = a^X mod p，已知X的情况下，很容易算出Y；已知道Y的情况下，很难算出X；")]),s("li",[t._v("(a^Xa mod p)^Xb mod p = a^(Xa * Xb) mod p")])]),s("h2",{attrs:{id:"握手步骤说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#握手步骤说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 握手步骤说明")]),s("p",[t._v("假设客户端、服务端挑选两个素数a、p（都公开），然后")]),s("ul",[s("li",[t._v("客户端：选择自然数Xa，Ya = a^Xa mod p，并将Ya发送给服务端；")]),s("li",[t._v("服务端：选择自然数Xb，Yb = a^Xb mod p，并将Yb发送给客户端；")]),s("li",[t._v("客户端：计算 Ka = Yb^Xa mod p")]),s("li",[t._v("服务端：计算 Kb = Ya^Xb mod p")])]),s("blockquote",[s("p",[t._v("Ka = Yb^Xa mod p\n= (a^Xb mod p)^Xa mod p\n= a^(Xb * Xa) mod p\n= (a^Xa mod p)^Xb mod p\n= Ya^Xb mod p\n= Kb")])]),s("p",[t._v("可以看到，尽管客户端、服务端彼此不知道对方的Xa、Xb，但算出了相等的secret。")]),s("h2",{attrs:{id:"nodejs代码示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nodejs代码示例","aria-hidden":"true"}},[t._v("#")]),t._v(" Nodejs代码示例")]),s("p",[t._v("结合前面小结的介绍来看下面代码，其中，要点之一就是client、server采用相同的素数a、p。")]),s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" crypto "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("require")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'crypto'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" primeLength "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("1024")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{attrs:{class:"token comment"}},[t._v("// 素数p的长度")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" generator "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("5")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{attrs:{class:"token comment"}},[t._v("// 素数a")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 创建客户端的DH实例")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" client "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" crypto"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("createDiffieHellman")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("primeLength"),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" generator"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 产生公、私钥对，Ya = a^Xa mod p")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" clientKey "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("generateKeys")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 创建服务端的DH实例，采用跟客户端相同的素数a、p")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" server "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" crypto"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("createDiffieHellman")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("client"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getPrime")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" client"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getGenerator")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 产生公、私钥对，Yb = a^Xb mod p")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" serverKey "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" server"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("generateKeys")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 计算 Ka = Yb^Xa mod p")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" clientSecret "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" client"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("computeSecret")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("server"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getPublicKey")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 计算 Kb = Ya^Xb mod p")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" serverSecret "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" server"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("computeSecret")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("client"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getPublicKey")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 由于素数p是动态生成的，所以每次打印都不一样")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 但是 clientSecret === serverSecret")]),t._v("\nconsole"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("clientSecret"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("toString")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'hex'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serverSecret"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("toString")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'hex'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),s("h2",{attrs:{id:"相关链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相关链接","aria-hidden":"true"}},[t._v("#")]),t._v(" 相关链接")]),s("p",[s("a",{attrs:{href:"http://wsfdl.com/algorithm/2016/02/04/%E7%90%86%E8%A7%A3Diffie-Hellman%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E7%AE%97%E6%B3%95.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("理解 Deffie-Hellman 密钥交换算法")])]),s("p",[s("a",{attrs:{href:"https://zh.wikipedia.org/zh-cn/%E8%BF%AA%E8%8F%B2-%E8%B5%AB%E7%88%BE%E6%9B%BC%E5%AF%86%E9%91%B0%E4%BA%A4%E6%8F%9B",target:"_blank",rel:"noopener noreferrer"}},[t._v("迪菲-赫尔曼密钥交换")])]),s("p",[s("a",{attrs:{href:"https://cafedev.org/article/2016/11/secure-messages-in-nodejs-using-ecdh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Secure messages in NodeJSusing ECDH")])]),s("p",[s("a",{attrs:{href:"https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Keyless SSL: The Nitty Gritty Technical Details")])])])}],!1,null,null,null);a.default=e.exports}}]);